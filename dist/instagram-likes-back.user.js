// ==UserScript==
// @name         Instagram Likes Back
// @namespace    instagram-likes-back
// @version      0.1.0
// @description  See likes in Instagram again
// @homepageURL  https://github.com/0xdv/instagram-likes-back
// @supportURL   https://github.com/0xdv/instagram-likes-back/issues
// @downloadURL  https://raw.githubusercontent.com/0xdv/instagram-likes-back/master/instagram-likes-back.user.js
// @updateURL    https://raw.githubusercontent.com/0xdv/instagram-likes-back/master/instagram-likes-back.user.js
// @author       0xC0FFEEC0DE
// @include      https://*.instagram.com/*
// @license      MIT
// ==/UserScript==
!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t){!function(e){"use strict";const t="fead941d698dc1160a298ba7bec277ac";let o={};!function(e,t){e.fetch;const o=XMLHttpRequest.prototype.send,n=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,t){this._method=e,this._url=t,n.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){this.addEventListener("load",(function(){t(this)})),o.apply(this,arguments)}}(e,e=>{let t=e._url.match(/query_hash=(.*)&/);if(!t)return;if("2c5d4d8b70cad329c4a6ebe3abb6eedd"!==t[1])return;console.log("intersepted");let n=JSON.parse(e.responseText).data.user.edge_owner_to_timeline_media.edges;console.log(n),n.forEach(e=>{let t={shortcode:e.node.shortcode,likes:e.node.edge_media_preview_like.count,comments:e.node.edge_media_to_comment.count,timestamp:Date.now()};o[t.shortcode]=t}),console.log(o)}),setTimeout(()=>{document.querySelectorAll("article").forEach(n)},1e3);new MutationObserver((function(e){let t=(e=Array.from(e)).find(e=>"ltpMr Slqrh"===e.target.className&&e.addedNodes[0]);if(t)return setTimeout(()=>{n(t.target.closest("article"))},1e3);let o=(()=>{let t=e.filter(e=>"PdwC2 _6oveC Z_y-9"===e.target.className)[0];return t&&r(t)})();(o=(o=o||(()=>{let t=e.filter(e=>"DIV"===e.target.nodeName).filter(e=>e.addedNodes[0]&&"ARTICLE"===e.addedNodes[0].nodeName);return t[0]&&t[0].addedNodes[0]})())||(()=>{let t=e.filter(e=>"BODY"===e.target.nodeName).filter(e=>e.addedNodes[0]&&"_2dDPU vCf6V"===e.addedNodes[0].className);return t[0]&&r(t[0])})())&&n(o)})).observe(document.body,{subtree:!0,childList:!0});function n(e){let n=function(e){let t=e.querySelector(".c-Yi7");return t&&t.href.split("/").slice(-2,-1).pop()}(e);var r;n&&(r=n,o[r]?Promise.resolve(o[r].likes):function(e){return function(e){let o={query_hash:t,variables:JSON.stringify({shortcode:e,child_comment_count:0,fetch_comment_count:0,parent_comment_count:0,has_threaded_comments:!0})};var n=Object.keys(o).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(o[e])).join("&");return fetch(`/graphql/query/?${n}`).then(e=>e.json())}(e).then(e=>e.data.shortcode_media.edge_media_preview_like.count)}(r)).then(t=>{!function(e,t){let o=function(e){return e.querySelector(".Nm9Fw, .HbPOm._9Ytll")}(e),n=o.querySelector("button");if(!n)return;n.textContent=`${Number(t).toLocaleString()} likes`,o.innerHTML="",o.appendChild(n)}(e,t)}).catch(e=>{console.error(e)})}function r(e){return e.target.querySelector("article.M9sTE")}}(window)}]);