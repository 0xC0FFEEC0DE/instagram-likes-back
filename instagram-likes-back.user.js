// ==UserScript==
// @name         Instagram Likes Back
// @namespace    instagram-likes-back
// @version      0.1.0
// @description  See likes in Instagram again
// @homepageURL  https://github.com/0xdv/instagram-likes-back
// @supportURL   https://github.com/0xdv/instagram-likes-back/issues
// @downloadURL  https://raw.githubusercontent.com/0xdv/instagram-likes-back/master/instagram-likes-back.user.js
// @updateURL    https://raw.githubusercontent.com/0xdv/instagram-likes-back/master/instagram-likes-back.user.js
// @author       0xC0FFEEC0DE
// @include      https://*.instagram.com/*
// @grant        none
// @license      MIT
// ==/UserScript==
!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const o={},r={push:e=>{e.timestamp=new Date(Date.now()),o[e.shortcode]=e},get:e=>o[e],getAll:()=>o};const c="fead941d698dc1160a298ba7bec277ac";function l(e){let t={query_hash:c,variables:JSON.stringify({shortcode:e,child_comment_count:0,fetch_comment_count:0,parent_comment_count:0,has_threaded_comments:!0})};var n=Object.keys(t).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e])).join("&");return fetch(`/graphql/query/?${n}`).then(e=>e.json())}function a(e){let t=e.data.shortcode_media,n={shortcode:t.shortcode,likes:t.edge_media_preview_like.count,comments:t.edge_media_to_parent_comment.count};return r.push(n),n}function d(e){let t=(e=Array.from(e)).find(e=>"ltpMr Slqrh"===e.target.className&&e.addedNodes[0]);if(t)return setTimeout(()=>{i(t.target.closest("article"),!0)},1e3);let n=(()=>{let t=e.filter(e=>"PdwC2 _6oveC Z_y-9"===e.target.className)[0];return t&&s(t)})();(n=(n=n||(()=>{let t=e.filter(e=>"DIV"===e.target.nodeName).filter(e=>e.addedNodes[0]&&"ARTICLE"===e.addedNodes[0].nodeName);return t[0]&&t[0].addedNodes[0]})())||(()=>{let t=e.filter(e=>"BODY"===e.target.nodeName).filter(e=>e.addedNodes[0]&&"_2dDPU vCf6V"===e.addedNodes[0].className);return t[0]&&s(t[0])})())&&i(n)}function i(e,t=!1){let n=function(e){let t=e.querySelector(".c-Yi7");return t&&t.href.split("/").slice(-2,-1).pop()}(e);n&&function(e,t){let n=!t&&r.get(e);return n?Promise.resolve(n.likes):l(e).then(a).then(e=>e.likes)}(n,t).then(t=>{!function(e,t){let n=function(e){return e.querySelector(".Nm9Fw, .HbPOm._9Ytll")}(e),o=n.querySelector("button");if(!o)return;o.textContent=`${Number(t).toLocaleString()} likes`,n.innerHTML="",n.appendChild(o)}(e,t)}).catch(e=>{})}function s(e){return e.target.querySelector("article.M9sTE")}function u(e){let t=e.querySelector("a");if(t.querySelector(".qn-0x"))return;let{div:n,likesSpan:o,commSpan:c}=function(){let e=document.createElement("div");e.className="qn-0x cover",e.style.backgroundColor="rgba(0, 0, 0, 0.3)";let t=document.createElement("ul");t.className="Ln-UN";let n=document.createElement("li");n.className="-V_eO";let o=document.createElement("span");n.appendChild(o);let r=document.createElement("span");r.className="_1P1TY coreSpriteHeartSmall",n.appendChild(r);let c=document.createElement("li");c.className="-V_eO";let l=document.createElement("span");c.appendChild(l);let a=document.createElement("span");return a.className="_1P1TY coreSpriteSpeechBubbleSmall",c.appendChild(a),t.appendChild(n),t.appendChild(c),e.appendChild(t),{div:e,likesSpan:o,commSpan:l}}();t.appendChild(n),function(e){let t=r.get(e);return t?Promise.resolve(t):l(e).then(a)}(t.href.split("/").slice(-2,-1).pop()).then(e=>{o.textContent=e.likes,c.textContent=e.comments})}function m(e){(e=Array.from(e)).filter(e=>e.addedNodes[0]&&"Nnq7C weEfm"===e.addedNodes[0].className).forEach(e=>{Array.from(e.addedNodes[0].querySelectorAll(".v1Nh3.kIKUG._bz0w")).forEach(p)})}function p(e){e.addEventListener("mouseover",(function(){this.querySelector(".cover")?this.querySelector(".cover").style.display="block":u(this)})),e.addEventListener("mouseout",(function(){this.querySelector(".cover").style.display="none"}))}!function(e){e.likeCache=r,function(e,t){e.fetch;const n=XMLHttpRequest.prototype.send,o=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,t){this._method=e,this._url=t,o.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){this.addEventListener("load",(function(){t(this)})),n.apply(this,arguments)}}(e,e=>{let t=e._url.match(/query_hash=(.*)&/);t&&"2c5d4d8b70cad329c4a6ebe3abb6eedd"===t[1]&&JSON.parse(e.responseText).data.user.edge_owner_to_timeline_media.edges.forEach(e=>{r.push({shortcode:e.node.shortcode,likes:e.node.edge_media_preview_like.count,comments:e.node.edge_media_to_comment.count})})}),setTimeout(()=>{!function(e){e.forEach(i)}(document.querySelectorAll("article")),function(e){e.forEach(p)}(Array.from(document.querySelectorAll(".v1Nh3.kIKUG._bz0w")))},500);new MutationObserver(d).observe(document.body,{subtree:!0,childList:!0}),new MutationObserver(m).observe(document.body,{subtree:!0,childList:!0})}(window)}]);