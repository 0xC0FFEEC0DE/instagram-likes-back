// ==UserScript==
// @name         Instagram Likes Back
// @namespace    instagram-likes-back
// @version      0.1.4
// @description  See likes in Instagram again
// @homepageURL  https://github.com/0xdv/instagram-likes-back
// @supportURL   https://github.com/0xdv/instagram-likes-back/issues
// @downloadURL  https://raw.githubusercontent.com/0xdv/instagram-likes-back/master/instagram-likes-back.user.js
// @updateURL    https://raw.githubusercontent.com/0xdv/instagram-likes-back/master/instagram-likes-back.user.js
// @author       0xC0FFEEC0DE
// @include      https://*.instagram.com/*
// @grant        none
// @license      MIT
// ==/UserScript==
!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const o={},r={push:e=>{e.timestamp=new Date(Date.now()),o[e.shortcode]=e},get:e=>o[e],getAll:()=>o};const d="/graphql/query/",c="fead941d698dc1160a298ba7bec277ac",a="d5d763b1e2acf209d62d22d184488e57";function l(e){let t={query_hash:c,variables:JSON.stringify({shortcode:e,child_comment_count:0,fetch_comment_count:0,parent_comment_count:0,has_threaded_comments:!0})};var n=Object.keys(t).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e])).join("&");return fetch(`${d}?${n}`).then(e=>e.json()).then(e=>-1===e.data.shortcode_media.edge_media_preview_like.count?function(e){let t={query_hash:a,variables:JSON.stringify({shortcode:e,include_reel:!0,first:1})};var n=Object.keys(t).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e])).join("&");return fetch(`${d}?${n}`).then(e=>e.json())}(e.data.shortcode_media.shortcode).then(t=>(e.data.shortcode_media.edge_media_preview_like.count=t.data.shortcode_media.edge_liked_by.count,e)):Promise.resolve(e))}function i(e){let t=e.data.shortcode_media,n={shortcode:t.shortcode,likes:t.edge_media_preview_like.count,comments:t.edge_media_to_parent_comment.count};return r.push(n),n}function s(e){let t=(e=Array.from(e)).find(e=>"ltpMr Slqrh"===e.target.className&&e.addedNodes[0]);if(t)return setTimeout(()=>{u(t.target.closest("article"),!0)},1e3);let n=(()=>{let t=e.filter(e=>"PdwC2 _6oveC Z_y-9"===e.target.className)[0];return t&&m(t)})();(n=(n=n||(()=>{let t=e.filter(e=>"DIV"===e.target.nodeName).filter(e=>e.addedNodes[0]&&"ARTICLE"===e.addedNodes[0].nodeName);return t[0]&&t[0].addedNodes[0]})())||(()=>{let t=e.filter(e=>"BODY"===e.target.nodeName).filter(e=>e.addedNodes[0]&&"_2dDPU vCf6V"===e.addedNodes[0].className);return t[0]&&m(t[0])})())&&u(n)}function u(e,t=!1){let n=function(e){let t=e.querySelector(".c-Yi7");return t&&t.href.split("/").slice(-2,-1).pop()}(e);n&&function(e,t){let n=!t&&r.get(e);return n?Promise.resolve(n.likes):l(e).then(i).then(e=>e.likes)}(n,t).then(t=>{!function(e,t){let n=function(e){let t=e.querySelector(".Nm9Fw, .HbPOm._9Ytll");t||(t=function(e){let t=e.querySelector(".ltpMr.Slqrh"),n=document.createElement("section");n.className="EDfFK ygqzn";let o=document.createElement("div");o.className="Igw0E IwRSH eGOV_ ybXk5 vwCYk";let r=document.createElement("div");r.className="Nm9Fw";let d=document.createElement("button");return d.className="sqdOP yWX7d _8A5w5",d.type="button",t.parentNode.insertBefore(n,t.nextSibling),n.appendChild(o),o.appendChild(r),r.appendChild(d),r}(e));return t}(e),o=n.querySelector("button");if(!o)return;o.textContent=`${Number(t).toLocaleString()} likes`,n.innerHTML="",n.appendChild(o)}(e,t)}).catch(e=>{})}function m(e){return e.target.querySelector("article.M9sTE")}function p(e){let t=e.querySelector("a");if(t.querySelector(".qn-0x"))return;let{div:n,likesSpan:o,commSpan:d}=function(){let e=document.createElement("div");e.className="qn-0x cover",e.style.backgroundColor="rgba(0, 0, 0, 0.3)";let t=document.createElement("ul");t.className="Ln-UN";let n=document.createElement("li");n.className="-V_eO";let o=document.createElement("span");n.appendChild(o);let r=document.createElement("span");r.className="_1P1TY coreSpriteHeartSmall",n.appendChild(r);let d=document.createElement("li");d.className="-V_eO";let c=document.createElement("span");d.appendChild(c);let a=document.createElement("span");return a.className="_1P1TY coreSpriteSpeechBubbleSmall",d.appendChild(a),t.appendChild(n),t.appendChild(d),e.appendChild(t),{div:e,likesSpan:o,commSpan:c}}();t.appendChild(n),function(e){let t=r.get(e);return t?Promise.resolve(t):l(e).then(i)}(t.href.split("/").slice(-2,-1).pop()).then(e=>{o.textContent=e.likes.toLocaleString(),d.textContent=e.comments})}function f(e){e.forEach(_)}function h(e){(e=Array.from(e)).filter(e=>e.addedNodes[0]&&"Nnq7C weEfm"===e.addedNodes[0].className).forEach(e=>{Array.from(e.addedNodes[0].querySelectorAll(".v1Nh3.kIKUG._bz0w")).forEach(_)})}function _(e){e.addEventListener("mouseover",(function(){this.querySelector(".cover")?this.querySelector(".cover").style.display="block":p(this)})),e.addEventListener("mouseout",(function(){!function(e){let t=e.querySelector(".cover");t&&(t.style.display="none")}(this)}))}!function(e){e.likeCache=r,function(e,t){e.fetch;const n=XMLHttpRequest.prototype.send,o=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,t){this._method=e,this._url=t,o.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){this.addEventListener("load",(function(){t(this)})),n.apply(this,arguments)}}(e,e=>{let t=e._url.match(/query_hash=(.*)&/);if(!t)return;let n=t[1];if("e769aa130647d2354c40ea6a439bfc08"===n){JSON.parse(e.responseText).data.user.edge_owner_to_timeline_media.edges.forEach(e=>{r.push({shortcode:e.node.shortcode,likes:e.node.edge_media_preview_like.count,comments:e.node.edge_media_to_comment.count})})}else if("be74df6f00b60e676929508979bee98c"===n){JSON.parse(e.responseText).data.user.edge_web_feed_timeline.edges.forEach(e=>{r.push({shortcode:e.node.shortcode,likes:e.node.edge_media_preview_like.count,comments:e.node.edge_media_preview_comment.count})})}else if("c9100bf9110dd6361671f113dd02e7d6"===n){f(Array.from(document.querySelectorAll(".v1Nh3.kIKUG._bz0w")))}}),setTimeout(()=>{!function(e){e.forEach(u)}(document.querySelectorAll("article")),f(Array.from(document.querySelectorAll(".v1Nh3.kIKUG._bz0w")))},500);new MutationObserver(s).observe(document.body,{subtree:!0,childList:!0}),new MutationObserver(h).observe(document.body,{subtree:!0,childList:!0})}(window)}]);